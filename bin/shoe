#!/usr/bin/env ruby

require 'erb'
require 'pathname'

class String
  def unindent
    gsub(/^  /, '')
  end
end

def root
  Pathname.pwd.expand_path
end

def spec
  spec = Gem::Specification.new do |spec|
    spec.name = root.basename.to_s
    spec.version = '0.0.0'
  end

  def spec.class_name
    name.capitalize.gsub(/_(\w)/) { $1.upcase }
  end

  spec
end

def create_file(name, contents)
  file     = root.join(name)
  template = ERB.new(contents)

  if file.exist?
    STDERR.puts("#{name} exists. Not clobbering.")
  else
    file.parent.mkpath
    file.open('w') do |stream|
      stream.write(template.result)
    end
  end
end

create_file 'Rakefile', <<-END.unindent
  require 'shoe'
  require '<%= spec.name %>/version'

  Shoe.tie('<%= spec.name %>', <%= spec.class_name %>::VERSION, 'TODO write a summary of <%= spec.class_name %> here.') do |spec|
    # do whatever you want with the Gem::Specification here, for example:
    # spec.add_development_dependency 'shoulda'
  end
END

create_file 'README.rdoc', <<-END.unindent
  = <%= spec.class_name %>

  <%= spec.class_name %> is one of my favorite things! Let me tell you about it:
END

create_file "#{spec.name}.gemspec", spec.to_ruby

create_file "lib/#{spec.name}/version.rb", <<-END.unindent
  class <%= spec.class_name %>
    VERSION = '<%= spec.version %>'
  end
END
